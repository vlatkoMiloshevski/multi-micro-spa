<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width" />
	<title>Single SPA</title>
</head>

<body>
	<script src="./system.js"></script>
	<!-- Load the application -->
	<script src="./main.js"></script>
	<!-- Static navbar -->
	<link rel="stylesheet" href="./style.css">
	<link rel="stylesheet" href="http://localhost:9006/spaModule.css">

	<!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
	<!-- FontAwesome core CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<!-- Sidebar -->
	<div class="d-flex" id="wrapper">
		<div class="background-secondary" id="sidebar-wrapper">
			<div class="list-group list-group-flush">
				<a href="" style="height: 40px;" class="menu-toggle list-group-item background-secondary">
					<i class="fa fa-2x fa-navicon" style="visibility:hidden"></i>
				</a>
				<a href="#/angularjs" class="list-group-item list-group-item-action background-secondary">Angular JS</a>
				<a href="#/app6" class="list-group-item list-group-item-action background-secondary">Angular 6 (first
					instance)</a>
				<a href="#/ng6" class="list-group-item list-group-item-action background-secondary">Angular 6 (second
					instance)</a>
				<a href="#/react" class="list-group-item list-group-item-action background-secondary">React</a>
			</div>
		</div>


		<!-- Page Content -->
		<div class="loader" style="position: absolute;left: 500px;right: 500px;top: 300px;bottom: 200px;z-index: 1000">
			<div style="width: 120px;height: 100px;margin: 0px auto">
				<img style="height:100%; width:100%" src="https://www.rogers.com/web/smb/bss/images/widget-loader-lg_no-lang.gif" />
			</div>
		</div>

		<div class="menu-toggle" style="height:50px;position:absolute;z-index: 10000;">
			<a href="">
				<i class="fa fa-2x fa-navicon menu-body-toggle" style="margin: 5px 20px"></i>
			</a>
		</div>

		<div id="page-content-wrapper">

			<div style="height: 40px; border-bottom: 2px solid ghostwhite; position: relative;margin: 0 2px; background-color: white;">

				<div style="position: relative; width: 100%; float:right;  height: 38px; overflow: hidden;">
					<div style="float: right; padding:5px 20px">
						Welcome back <b id="loggedUser"></b> | <a href=""> <i id="logout_btn" style="color: black" class="fa fa-sign-out logout-icon"></i>
						</a>
					</div>
					<div style="float: left; margin-left: 65px;">

					</div>
				</div>
			</div>

			<div id="main-container">
			</div>
		</div>

		<div id="login_form" style="width: 100%; height: 700px">
			<div class=" container h-100">
				<div class="d-flex justify-content-center h-100">
					<div class="user_card">
						<div class="d-flex justify-content-center">
							<div class="brand_logo_container">
								<!-- <img src="https://media.licdn.com/dms/image/C4E0BAQGFB8rg6CaHLQ/company-logo_200_200/0?e=2159024400&v=beta&t=yQBREZMf3pagkvkv4w1ZXvhQiQ6-n2tmMMs4QowSoYs"
								 class="brand_logo" alt="Logo"> -->
							</div>
						</div>
						<div class="d-flex justify-content-center form_container">
							<form>
								<div class="input-group mb-3">
									<div class="input-group-append">
										<span class="input-group-text"><i class="fa fa-user-o"></i></span>
									</div>
									<input type="text" name="" id="username" class="form-control input_user" value="" placeholder="username">
								</div>
								<div class="input-group mb-2">
									<div class="input-group-append">
										<span class="input-group-text"><i class="fa fa-key"></i></span>
									</div>
									<input type="password" name="" id="password" class="form-control input_pass" value="" placeholder="password">
								</div>
								<div class="input-group mb-2">
									<div class="input-group-append">
										<span class="input-group-text"><i class="fa fa-key"></i></span>
									</div>
									<input type="email" name="" id="email" class="form-control input_pass" value="" placeholder="email">
								</div>
								<div class="form-group">
									<div class="custom-control custom-checkbox">
										<input type="checkbox" class="custom-control-input" id="customControlInline">
										<!-- <label class="custom-control-label" for="customControlInline">Remember me</label> -->
									</div>
								</div>
							</form>
						</div>
						<div class="d-flex justify-content-center mt-3 login_container">
							<button type="button" name="button" id="login_btn" class="btn login_btn">Login</button>
						</div>
						<div class="d-flex justify-content-center mt-3 login_container">
							<button type="button" name="button" id="register_btn" class="btn login_btn">Register</button>
						</div>
						<!-- <div class="mt-4">
							<div class="d-flex justify-content-center links">
								Don't have an account? <a href="#" class="ml-2">Sign Up</a>
							</div>
							<div class="d-flex justify-content-center links">
								<a href="#">Forgot your password?</a>
							</div>
						</div> -->
					</div>
				</div>
			</div>
		</div>

	</div>

	<!-- Bootstrap core JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

	<script>
		(function () {
			if (localStorage.getItem("user")) {
				$('#loggedUser').text(JSON.parse(localStorage.getItem("user")).username);
				$("#login_form").toggleClass("display-none");
				$(".loader").toggleClass("display-block");
				helper();
			}

			$(".menu-toggle").click(function (e) {
				e.preventDefault();
				$("#wrapper").toggleClass("toggled");
				$(".menu-body-toggle").toggleClass("menu-color");
			});

			$("#login_btn").click(function (e) {
				var username = document.getElementById('username').value;
				var password = document.getElementById('password').value;

				if (!username || !password) {
					console.error("invalid login data");
					return;
				}

				$.ajax({
					method: "POST",
					data: { username: username, password: password },
					url: "/api/login",
					success: function (success) {
						localStorage.setItem("user", JSON.stringify(success.user));
						$('#loggedUser').text(success.user.username);
						$("#login_form").toggleClass("display-none");
						$(".loader").toggleClass("display-block");
						helper();
					},
					error: function (error) {
						console.log(error.responseJSON.message);
					}
				});
			});

			$("#register_btn").click(function (e) {
				var username = document.getElementById('username').value;
				var password = document.getElementById('password').value;
				var email = document.getElementById('email').value;

				if (!username || !password || !email) {
					console.error("invalid register data");
					return;
				}

				$.ajax({
					method: "POST",
					data: { username: username, password: password, email: email },
					url: "/api/register",
					success: function (success) {
						localStorage.setItem("user", JSON.stringify(success.user));
						$('#loggedUser').text(success.user.username);
						$("#login_form").toggleClass("display-none");
						$(".loader").toggleClass("display-block");
						helper();
					},
					error: function (error) {
						console.log(error.responseJSON.message);
					}
				});
			});

			$(".input_pass").keypress(function (e) {
				if (e.keyCode == 13) {
					$("#login_form").toggleClass("display-none");
					$(".loader").toggleClass("display-block");
					helper();
				}
			});

			$("#logout_btn").click(function (e) {
				$.ajax({
					method: "POST",
					data: {},
					url: "/api/logout",
					success: function (success) {
						localStorage.clear("user");
						$('#loggedUser').text('');
						window.location.reload();
					},
					error: function (error) {
						console.log("Error while trying to logout");
						localStorage.clear("user");
						$('#loggedUser').text('');
						window.location.reload();
					}
				});
			});

			function helper() {
				setTimeout(function () {
					$(".loader").toggleClass("display-block");
					$("#page-content-wrapper").toggleClass("display-block");
					$(".menu-toggle").toggleClass("display-block");
					$(".menu-body-toggle").toggleClass("menu-color");
				}, 2000)
			}
		})();
	</script>
</body>

</html>